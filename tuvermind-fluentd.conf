<system>
  log_level debug
</system>

<match fluent.**>
    @type copy
    <store>
        @type stdout
    </store>
    <store>
      @type elasticsearch
      host elasticsearch
      port 9200
      index_name fluentd
      type_name fluentd
      include_tag_key true
      logstash_format true
      logstash_prefix fluentd
      <buffer>
        flush_interval 1s
      </buffer>
    </store>
</match>

<source>
    @type forward
    port 24224
    bind "0.0.0.0"
</source>

<filter tuvermind.celery>
    @type grep
    <regexp>
        key log
        reserve_time true
        pattern special_fluentd_tag
    </regexp>
</filter>

<filter tuvermind.celery>
  @type parser
  key_name log
  <parse>
    @type json
    time_type float
  </parse>
</filter>

<match tuvermind.**>
    @type copy
    <store>
        @type stdout
    </store>

    <store>
      @type elasticsearch
      host elasticsearch
      port 9200
      index_name fluentd
      type_name fluentd
      include_tag_key true
      logstash_format true
      logstash_prefix tuvermind
      time_key
      <buffer>
        flush_interval 1s
      </buffer>
    </store>
</match>
